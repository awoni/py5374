"use strict";$(function(){var areaModels,trash,descriptions=[];function setSelectedAreaName(name){localStorage.setItem("selected_area_name",name)}function targetHTML(description){if(null==TargetSettings){var target_tag="",furigana="",targets=(target_tag="",description.targets);for(var j in targets){var target=targets[j];furigana!=target.furigana&&(""!=furigana&&(target_tag+="</ul>"),target_tag+='<h4 class="initials">'+(furigana=target.furigana)+"</h4>",target_tag+="<ul>"),target_tag+='<li style="list-style:none;"><div>'+target.name+"</div>",target_tag+='<div class="note">'+target.notice+"</div></li>"}return target_tag+="</ul>"}var tg=TargetSettings[description.label];return document.getElementById(tg).innerHTML}function updateData(row_index){$.get("data/"+areaModels[row_index].収集地区+".json",function(data){trash=data;var now=new Date;for(var i in trash){var t=trash[i];for(var j in t.dayList){var dt=new Date(t.dayList[j]+"T00:00:00+09:00");if(-864e5<dt-now){t.mostRecentText=t.dayList[j],t.mostRecent=dt;break}}void 0===t.mostRecent?(t.leftDayText,t.leftDay):(t.leftDay=Math.ceil((t.mostRecent.getTime()-now.getTime())/864e5),0==t.leftDay?t.leftDayText="今日":1==t.leftDay?t.leftDayText="明日":2==t.leftDay?t.leftDayText="明後日":t.leftDayText=t.leftDay+"日後")}trash.sort(function(a,b){return a.leftDay-b.leftDay}),function(){var ableSVG=void 0!==window.SVGAngle,accordion_height=$(window).height()/descriptions.length;4<descriptions.length&&(140<(accordion_height/=4.1)&&(accordion_height/=descriptions.length),accordion_height<130&&(accordion_height=130));var styleHTML="",accordionHTML="";for(var i in trash){var t=trash[i];for(var d_no in descriptions){var description=descriptions[d_no];if(description.label==t.label){var target_tag=targetHTML(description);styleHTML+="#accordion-group"+d_no+"{background-color:  "+description.bgcolor+";} ";var strs=t.mostRecentText.match(/^\d+-(\d+)-(\d+)/),dateStr=Number(strs[1])+"月"+Number(strs[2])+"日";accordionHTML+='<div class="accordion-group" id="accordion-group'+d_no+'"><div class="accordion-heading"><a class="accordion-toggle" style="height:'+accordion_height+'px" data-toggle="collapse" data-parent="#accordion" href="#collapse'+i+'"><div class="left-day">'+t.leftDayText+" ("+dateStr+')</div><div class="accordion-table" >',ableSVG&&SVGLabel?accordionHTML+='<img src="'+description.styles+'" alt="'+description.label+'"  />':accordionHTML+='<p class="text-center">'+description.label+"</p>",accordionHTML+='</div><h6><p class="text-left date">'+(null==t.remark?"":t.remark)+"<br />"+t.dayLabel+'</p></h6></a></div><div id="collapse'+i+'" class="accordion-body collapse"><div class="accordion-inner">'+(null==description.description?"":description.description)+"<br />"+target_tag+'<div class="targetDays"></div></div></div></div>'}}}$("#accordion-style").html("\x3c!-- "+styleHTML+" --\x3e"),$("#accordion").html(accordionHTML),$("html,body").animate({scrollTop:0},"fast"),$(".accordion-body").on("shown.bs.collapse",function(){var body=$("body"),accordion_offset=$($(this).parent().get(0)).offset().top;body.animate({scrollTop:accordion_offset},50)}),$(".accordion-body").on("hidden.bs.collapse",function(){0==$(".in").length&&$("html, body").scrollTop(0)})}()})}function onChangeSelect(row_index){if(-1==row_index)return $("#accordion").html(""),void setSelectedAreaName("");var after_action;setSelectedAreaName(areaModels[row_index].地名),0===$("#accordion").children().length&&0===descriptions.length?(after_action=function(){updateData(row_index)},$.get("data/description.json",function(data){descriptions=data,null==TargetSettings?$.get("data/target.json",function(data){for(var i in data)for(var j=0;j<descriptions.length;j++)if(descriptions[j].label==data[i].label){descriptions[j].targets.push(data[i]);break}after_action(),$("#accordion2").show()}):(after_action(),$("#accordion2").show())})):updateData(row_index)}$("#select_area").change(function(data){onChangeSelect($(data.target).val())}),$.get("data/area.json",function(data){areaModels=data;var selected_name=localStorage.getItem("selected_area_name"),area_select_form=$("#select_area"),select_html="";for(var i in select_html+='<option value="-1">地域を選択してください</option>',areaModels){var area_name=areaModels[i].地名;select_html+='<option value="'+i+'" '+(selected_name==area_name?'selected="selected"':"")+" >"+area_name+"</option>"}area_select_form.html(select_html),area_select_form.change()})});